<div class="review-container">
  <div class="page-header">
    <div class="header-left">
      <button class="btn btn-secondary btn-back" (click)="cancel()" title="Go back to draft invoices">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5"></path>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Back
      </button>
      <div>
        <h1>Review Draft Invoice</h1>
        <p class="subtitle">Review and edit extracted invoice data before activation</p>
      </div>
    </div>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
      <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading invoice data...</p>
  </div>

  <!-- Review Form -->
  <div *ngIf="!isLoading && draftInvoice" class="review-content">
    <!-- Extracted Data Summary -->
    <div class="extracted-data-section">
      <h2>Extracted Data</h2>
      <div class="extracted-info">
        <div class="info-item" *ngIf="extractedData?.customerName">
          <span class="label">Customer:</span>
          <span class="value">{{ extractedData?.customerName }}</span>
        </div>
        <div class="info-item" *ngIf="extractedData?.customerEmail">
          <span class="label">Email:</span>
          <span class="value">{{ extractedData?.customerEmail }}</span>
        </div>
        <div class="info-item" *ngIf="extractedData?.customerPhone">
          <span class="label">Phone:</span>
          <span class="value">{{ extractedData?.customerPhone }}</span>
        </div>
        <div class="info-item" *ngIf="extractedData?.currency">
          <span class="label">Currency:</span>
          <span class="value">{{ extractedData?.currency }}</span>
        </div>
        <div class="info-item" *ngIf="extractedData?.notes">
          <span class="label">Notes:</span>
          <span class="value">{{ extractedData?.notes }}</span>
        </div>
      </div>

      <!-- Line Items -->
      <div *ngIf="hasLineItems()" class="line-items-section">
        <h3>Line Items</h3>
        <table class="line-items-table">
          <thead>
            <tr>
              <th>Description</th>
              <th>Quantity</th>
              <th>Unit Price</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of extractedData?.lineItems || []">
              <td>{{ item.description }}</td>
              <td>{{ item.quantity }}</td>
              <td>{{ formatCurrency(item.unitPrice) }}</td>
              <td>{{ formatCurrency(item.total) }}</td>
            </tr>
          </tbody>
          <tfoot *ngIf="extractedData?.totalAmount">
            <tr>
              <td colspan="3" class="total-label">Total Amount:</td>
              <td class="total-value">{{ formatCurrency(extractedData?.totalAmount) }}</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <!-- Editable Form -->
    <div class="editable-form-section">
      <h2>Invoice Details</h2>
      <p class="form-note">Edit the fields below and confirm to activate this invoice.</p>

      <form class="invoice-form">
        <div class="form-group">
          <label for="invoiceNumber">Invoice Number *</label>
          <input
            type="text"
            id="invoiceNumber"
            [(ngModel)]="formData.invoiceNumber"
            name="invoiceNumber"
            class="form-control"
            placeholder="Enter invoice number"
            [disabled]="isSaving"
            required
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="invoiceDate">Invoice Date *</label>
            <input
              type="date"
              id="invoiceDate"
              [(ngModel)]="formData.invoiceDate"
              name="invoiceDate"
              class="form-control"
              [disabled]="isSaving"
              required
            />
          </div>

          <div class="form-group">
            <label for="dueDate">Due Date</label>
            <input
              type="date"
              id="dueDate"
              [(ngModel)]="formData.dueDate"
              name="dueDate"
              class="form-control"
              [disabled]="isSaving"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="amount">Amount *</label>
          <input
            type="number"
            id="amount"
            [(ngModel)]="formData.amount"
            name="amount"
            class="form-control"
            placeholder="0.00"
            step="0.01"
            min="0"
            [disabled]="isSaving"
            required
          />
        </div>
      </form>
    </div>

    <!-- Action Buttons -->
    <div class="form-actions">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="cancel()"
        [disabled]="isSaving"
      >
        Cancel
      </button>
      <button
        type="button"
        class="btn btn-primary"
        (click)="confirmInvoice()"
        [disabled]="!isFormValid() || isSaving"
      >
        <span *ngIf="!isSaving">Confirm & Activate Invoice</span>
        <span *ngIf="isSaving">
          <span class="spinner-small"></span> Activating...
        </span>
      </button>
    </div>
  </div>
</div>

