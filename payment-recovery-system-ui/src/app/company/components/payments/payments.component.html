<div class="payments-container">
  <div class="page-header">
    <h1>Payments</h1>
    <p class="subtitle">View payment records and manage invoice payments</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Mark as Paid Form Modal -->
  <div *ngIf="selectedInvoice" class="modal-overlay" (click)="closeMarkAsPaidForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Mark Invoice as Paid</h2>
        <button class="btn-close" (click)="closeMarkAsPaidForm()" [disabled]="isMarkingPaid">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="invoice-info">
          <p><strong>Invoice:</strong> {{ selectedInvoice.invoiceNumber }}</p>
          <p><strong>Customer:</strong> {{ selectedInvoice.customerName || 'N/A' }}</p>
          <p><strong>Invoice Amount:</strong> {{ formatCurrency(selectedInvoice.amount) }}</p>
        </div>

        <form class="payment-form">
          <div class="form-group">
            <label for="amountReceived">Amount Received *</label>
            <input
              type="number"
              id="amountReceived"
              [(ngModel)]="markPaidForm.amountReceived"
              name="amountReceived"
              class="form-control"
              placeholder="0.00"
              step="0.01"
              min="0"
              [disabled]="isMarkingPaid"
              required
            />
          </div>

          <div class="form-group">
            <label for="paymentDate">Payment Date *</label>
            <input
              type="date"
              id="paymentDate"
              [(ngModel)]="markPaidForm.paymentDate"
              name="paymentDate"
              class="form-control"
              [disabled]="isMarkingPaid"
              required
            />
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeMarkAsPaidForm()"
          [disabled]="isMarkingPaid"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="markInvoiceAsPaid()"
          [disabled]="isMarkingPaid || !markPaidForm.amountReceived || !markPaidForm.paymentDate"
        >
          <span *ngIf="!isMarkingPaid">Mark as Paid</span>
          <span *ngIf="isMarkingPaid">
            <span class="spinner-small"></span> Processing...
          </span>
        </button>
      </div>
    </div>
  </div>

  <!-- Pending Invoices Section (Quick Actions) -->
  <div *ngIf="showPendingSection && pendingInvoices.length > 0" class="pending-section">
    <div class="section-header">
      <h2>Quick Actions - Mark Invoices as Paid</h2>
      <button class="btn-link" (click)="showPendingSection = false">Hide</button>
    </div>
    <div class="pending-invoices-list">
      <div *ngFor="let invoice of pendingInvoices" class="pending-invoice-card">
        <div class="invoice-info">
          <strong>{{ invoice.invoiceNumber }}</strong>
          <span class="customer-name">{{ invoice.customerName || 'N/A' }}</span>
          <span class="amount">{{ formatCurrency(invoice.amount) }}</span>
        </div>
        <button
          class="btn btn-primary btn-sm"
          (click)="openMarkAsPaidForm(invoice)"
        >
          Mark as Paid
        </button>
      </div>
    </div>
  </div>

  <!-- Payments List Section -->
  <div class="payments-section">
    <div class="section-header">
      <h2>Payment Records</h2>
      <p class="section-subtitle">List of all payments received</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading && payments.length === 0" class="loading-container">
      <div class="spinner"></div>
      <p>Loading payments...</p>
    </div>

    <!-- Payments Table -->
    <div *ngIf="!isLoading || payments.length > 0" class="table-container">
      <table class="payments-table">
        <thead>
          <tr>
            <th>Invoice Number</th>
            <th>Customer</th>
            <th>Amount Received</th>
            <th>Payment Date</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let payment of payments">
            <td>
              <strong>{{ payment.invoiceNumber }}</strong>
            </td>
            <td>{{ payment.customerName || 'N/A' }}</td>
            <td class="amount-cell">{{ formatCurrency(payment.amountReceived) }}</td>
            <td>{{ formatDate(payment.paymentDate) }}</td>
          </tr>
          <tr *ngIf="payments.length === 0 && !isLoading">
            <td colspan="4" class="empty-row">
              No payment records found
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div *ngIf="payments.length > 0" class="pagination">
      <div class="pagination-info">
        Showing {{ (currentPage * pageSize) + 1 }} to {{ Math.min((currentPage + 1) * pageSize, totalPayments) }} of {{ totalPayments }} payments
      </div>
      <div class="pagination-controls">
        <button
          class="btn btn-secondary"
          (click)="previousPage()"
          [disabled]="!hasPreviousPage() || isLoading"
        >
          Previous
        </button>
        <span class="page-info">
          Page {{ currentPage + 1 }} of {{ getTotalPages() }}
        </span>
        <button
          class="btn btn-secondary"
          (click)="nextPage()"
          [disabled]="!hasNextPage() || isLoading"
        >
          Next
        </button>
      </div>
    </div>
  </div>
</div>

